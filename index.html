const gbNumbers = [0, 3, 11, 17, 29, 41, 47, 50, 53, 59, 71, 83, 89, 97, 100];
        const ceNumbers = [7, 14, 23, 35, 44, 56, 65, 77];
        const algoEnd = [29, 35, 71, 77];

        const isGB = n => gbNumbers.includes(Math.abs(n));
        const isCE = n => ceNumbers.includes(Math.abs(n));
        const isAlgoEnd = n => algoEnd.includes(Math.abs(n));

        function getAnalysis(date, tz) {
            const options = { timeZone: tz, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const timeString = new Intl.DateTimeFormat('en-GB', options).format(date);
            const [h, m, s] = timeString.split(':').map(Number);
            
            const sum = h + m;
            const diff = Math.abs(m - h);
            return { h, m, s, sum, diff, time: `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}` };
        }

        function update() {
            const now = new Date();
            
            // تحديث الساعة الحية في الأعلى
            document.getElementById('live-time').textContent = now.toLocaleTimeString('en-GB');

            // تحديث الوقت الحالي لنيويورك وزيورخ
            const ny = getAnalysis(now, 'America/New_York');
            const zh = getAnalysis(now, 'Europe/Zurich');
            
            document.getElementById('ny-val').textContent = ny.time;
            document.getElementById('zh-val').textContent = zh.time;

            // تحديد حالة التقاطع الحالي
            const nyStatus = document.getElementById('ny-status');
            if (isAlgoEnd(ny.sum) || isAlgoEnd(ny.diff)) {
                nyStatus.innerHTML = '<span style="color:#ff0000; animation:blink 0.5s infinite;">CRITICAL TERMINATION</span>';
            } else if (isGB(ny.sum) || isCE(ny.sum)) {
                nyStatus.innerHTML = '<span style="color:#0f0;">ACTIVE CONFLUENCE</span>';
            } else {
                nyStatus.innerHTML = '<span style="color:#0ff;">SCANNING...</span>';
            }

            // تحديث قائمة الـ 1 Hour Window
            const list = document.getElementById('window-list');
            let content = '';

            for (let i = -60; i <= 60; i++) {
                const scanTime = new Date(now.getTime() + (i * 60000));
                const data = getAnalysis(scanTime, 'America/New_York');

                if (isGB(data.sum) || isCE(data.sum) || isGB(data.diff) || isCE(data.diff)) {
                    const critical = isAlgoEnd(data.sum) || isAlgoEnd(data.diff);
                    const itemClass = i < 0 ? 'past-item' : 'future-item';
                    const termClass = critical ? 'algo-termination' : '';
                    
                    content += `
                        <div class="confluence-item ${itemClass} ${termClass}">
                            <div style="display:flex; justify-content:space-between">
                                <strong>${data.time}</strong>
                                <span style="color:${i < 0 ? '#666' : '#0f0'}">${i === 0 ? 'NOW' : i + 'm'}</span>
                            </div>
                            <div style="font-size:0.8em; margin-top:5px;">
                                Sum: <span class="${isGB(data.sum)?'gb':'ce'}">${data.sum}</span> | 
                                Diff: <span class="${isGB(data.diff)?'gb':'ce'}">${data.diff}</span>
                                ${critical ? ' <span style="color:#ff0000; font-weight:bold;">[ALGO END]</span>' : ''}
                            </div>
                        </div>`;
                }
            }
            list.innerHTML = content;
        }

        setInterval(update, 1000);
        update();
